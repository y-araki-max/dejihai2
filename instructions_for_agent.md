# 開発引き継ぎメモ (Dejihai2)

このファイルは、本プロジェクトの目的、現状の仕様、および技術的な重要事項をまとめたものです。新しい担当者はこの内容を確認してから開発に着手してください。

## 1. プロジェクト概要
**プロジェクト名**: Dejihai2 (デジハイ2)
**目的**: 造船所向けの配材スケジュール管理システム。
**機能**: 管理者が配材依頼を入力し、スケジュール（ガントチャート風UI）で調整・閲覧するWebアプリケーション。

## 2. 主要な改修履歴（完了済み）
以下の機能はすでに実装・検証が完了しています。
1.  **Excel保存**: スケジュールデータをExcel形式でダウンロード可能。
2.  **D&D (ドラッグ&ドロップ)**: 直感的なスケジュール調整機能。
3.  **印刷機能の削除**: 以前存在したPDF保存/印刷ボタンは削除済み。
4.  **デザイン刷新**: 黒基調のダークモード、視認性の高い配色への変更。
5.  **連続入力**: 依頼入力フォームでのスムーズな登録フロー。

## 3. 特殊なUIルール（重要）
既存のUI/UXを壊さないよう、以下のルールを厳守してください。

### スケジュール操作 (Schedule Page)
- **移動制限**: タスクバーの移動は**横方向（時間変更）のみ**許可されています。縦方向（定盤/場所の変更）は禁止されており、システム側でブロックしています。
- **リサイズ**: タスクバーの**右端**に専用のハンドル（リサイズハンドル）があり、これをドラッグすることで時間を延長できます。
    - *注意*: リサイズハンドルはドラッグ移動（Move）と競合しないよう、`PointerDown` イベントで制御されています。

### 入力・表示項目
- **削除済み項目**: 「担当者名」「区画」のフィールドはUIおよび内部ロジックから完全に削除されました。
- **ブロック選択**: 以前の「大組」「中組」は廃止され、統合された「ブロック」プルダウン一つで選択する仕様になっています。

## 4. 技術的スタック・環境設定
- **Framework**: Next.js 14
- **React Version**: **React 18** (Renderでのデプロイ互換性維持のため、19ではなく18に意図的にダウングレード済み)。
- **ライブラリ**:
    - `@dnd-kit/core`, `@dnd-kit/modifiers`: D&D機能の中核。
        - `restrictToHorizontalAxis` モディファイアを使用し、移動方向を制御。
- **デプロイ (Render)**:
    - 静的生成によるキャッシュ問題を回避するため、主要なページ（`/schedule`, `/view`, `/request`）には `export const dynamic = 'force-dynamic';` を設定済み。
    - データベースは Render 上の PostgreSQL を使用。

## 5. 閲覧画面 (View Page) の独自レイアウト
スケジュール閲覧画面 (`/view`) は、以下の特殊なレイアウトロジックを持っています。

- **行の高さの自動拡張**:
    - 同じ時間帯にタスクが重なった場合、行（定盤の行）の高さが中身の数に応じて自動的に広がります。
    - 計算式: `1レーン 100px` + `上下パディング 20px`。
    - *目的*: タスクバーがグリッド線を突き抜けたり、重なって見えなくなるのを防ぐため。
- **コンテナの包含**:
    - グリッドのタイムスロットセル (`.time-cell`) やサイドヘッダー (`.location-cell`) も、この動的な行の高さに追従して伸縮します。

---
*Last Updated: 2026-01-19*
